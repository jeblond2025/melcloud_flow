# Adaugă acest script în scripts.yaml
# Folosește response_variable pentru a procesa răspunsul

  melcloud_login:
    alias: "MelCloud Login"
    sequence:
      - service: rest_command.melcloud_login
        response_variable: login_response
      - service: input_text.set_value
        entity_id: input_text.melcloud_context_key
        data_template: >
          {% if login_response.status == 200 %}
            {% set data = login_response.json() %}
            {% if data.ErrorId is none or data.ErrorId == null %}
              {{ data.LoginData.ContextKey }}
            {% else %}
              ERROR
            {% endif %}
          {% else %}
            ERROR
          {% endif %}

